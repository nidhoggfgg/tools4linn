# 文件提取功能使用指南

## 功能简介

文件提取功能可以从多层目录结构中提取符合条件的文件，并将它们复制到指定的目标目录中。此功能类似于 Excel 合并，但不是合并文件，而是将文件收集到一个统一的文件夹中。

## 主要特性

- **递归搜索**：自动搜索源目录及其所有子目录中的文件
- **文件组织方式**：
  - **扁平化**：所有文件直接放在输出目录根目录
  - **按第一层目录分组**：根据源文件的第一层目录名创建子文件夹，例如：
    - 源目录结构：`input/a/file1.txt`, `input/b/file2.txt`, `input/c/sub/file3.txt`
    - 输出目录结构：`output/a/file1.txt`, `output/b/file2.txt`, `output/c/file3.txt`
- **文件过滤**：支持多种文件过滤策略
  - 包含模式：根据文件名包含的关键词过滤
  - 正则模式：使用正则表达式匹配文件名
  - 扩展名模式：根据文件扩展名过滤（支持多个扩展名）
  - 大小模式：根据文件大小过滤（MB）
  - 目录模式：根据文件所在的目录路径过滤
- **覆盖控制**：可选择是否覆盖已存在的文件

## 使用步骤

### 1. 选择源目录

点击"浏览"按钮，选择要搜索的源目录。程序会递归搜索该目录及其所有子目录。

### 2. 选择目标目录

点击"浏览"按钮，选择提取文件的目标目录。所有符合条件的文件将被复制到此目录。

### 3. 选择文件组织方式

选择如何组织提取的文件：
- **扁平化**：所有文件直接放在输出目录根目录，不创建子文件夹
- **按第一层目录分组**：根据源文件所在的第一层目录名创建子文件夹

### 4. 配置文件过滤（必选）

文件过滤是必须的，选择过滤模式并设置过滤条件：

#### 包含模式
- 输入文件名包含的关键词
- 例如：`data` 将匹配所有文件名中包含 "data" 的文件

#### 正则模式
- 使用正则表达式匹配文件名
- 例如：`.*_data.*` 将匹配所有文件名中包含 "_data" 的文件
- 例如：`^test_\d+\.txt$` 将匹配 "test_1.txt", "test_123.txt" 等

#### 扩展名模式（默认）
- 输入文件扩展名，多个扩展名用逗号分隔
- 例如：`xlsx,xls` 将匹配所有 Excel 文件
- 例如：`txt,csv` 将匹配文本和 CSV 文件
- 例如：`xlsx,xls,pdf,docx,doc` 将匹配常见的办公文档

#### 大小模式
- 根据文件大小过滤，单位为 MB
- 格式：`最小值-最大值`，例如：`1-10` 表示 1MB 到 10MB
- 仅设置最小值：`5` 表示大于等于 5MB
- 仅设置最大值：`-10` 表示小于等于 10MB

#### 目录模式
- 根据文件所在的目录路径过滤
- 例如：`/data/` 将匹配所有路径中包含 "/data/" 的文件
- 例如：`Documents` 将匹配所有路径中包含 "Documents" 的文件

### 5. 覆盖选项

- 默认情况下，如果目标目录中已存在同名文件，会跳过该文件
- 勾选"覆盖已存在的文件"选项，将覆盖已存在的文件

### 6. 开始提取

点击"开始提取"按钮，程序会：
1. 搜索源目录中的所有文件
2. 根据过滤条件筛选文件
3. 按选定的组织方式将文件复制到目标目录
4. 显示操作日志和结果统计

## 使用场景

### 场景 1：收集分散的 Excel 文件（扁平化）
- 源目录：包含多层子目录的项目文件夹
- 组织方式：扁平化
- 过滤：扩展名模式 `xlsx,xls`
- 结果：所有 Excel 文件被提取到统一目录

### 场景 2：按部门收集文档（按目录分组）
- 源目录：`公司文档/部门A/`, `公司文档/部门B/`, `公司文档/部门C/`
- 组织方式：按第一层目录分组
- 过滤：扩展名模式 `docx,doc,pdf`
- 结果：`output/部门A/`, `output/部门B/`, `output/部门C/` 分别包含对应部门的文档

### 场景 3：从项目模块提取代码文件
- 源目录：`project/moduleA/src/`, `project/moduleB/src/`, `project/moduleC/src/`
- 组织方式：按第一层目录分组
- 过滤：扩展名模式 `py,js,java`
- 结果：`output/moduleA/`, `output/moduleB/`, `output/moduleC/` 分别包含对应模块的代码文件

### 场景 4：提取特定日期的日志文件
- 源目录：按日期组织的日志目录
- 组织方式：扁平化
- 过滤：正则模式 `2024-01-.*` 或包含模式 `2024-01-`
- 结果：只提取 2024 年 1 月的日志文件到统一目录

### 场景 5：清理临时目录中的大文件
- 源目录：临时文件目录
- 组织方式：扁平化
- 过滤：大小模式 `10-`（大于 10MB）
- 结果：提取所有大于 10MB 的文件以便检查

## 注意事项

1. **复制而非移动**：文件是被复制到目标目录，源文件保持不变
2. **文件名冲突**：如果不启用覆盖选项，同名文件会被跳过
3. **目录结构**：
   - 扁平化模式：所有文件会被放在同一目录，不保留原有的目录结构
   - 按第一层目录分组：根据第一层目录名创建子文件夹，但不保留更深层的目录结构
4. **性能考虑**：对于包含大量文件的目录，处理可能需要一些时间

## 技术细节

- 使用 Python 的 `shutil.copy2()` 进行文件复制，保留文件元数据
- 递归搜索使用 `Path.rglob()` 方法
- 支持所有文件过滤策略来自 `toolkits.utils.file_filter` 模块
- 支持两种文件组织方式：扁平化和按第一层目录分组
- 操作日志会实时显示在界面下方的日志区域

## 相关文件

- 核心功能：[toolkits/file/file_extractor.py](../toolkits/file/file_extractor.py)
- 控制器：[ui/controllers/file_extractor_controller.py](../ui/controllers/file_extractor_controller.py)
- UI 页面：[ui/pages/file_extractor_page.py](../ui/pages/file_extractor_page.py)
- 测试脚本：[example/test_file_extractor.py](../example/test_file_extractor.py)
